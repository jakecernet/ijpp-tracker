import{c as ce,r as f,j as c}from"./index-DQfCIfAk.js";import{H as de}from"./heart-1HfGplfo.js";/**
 * @license lucide-react v0.469.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const he=ce("Bus",[["path",{d:"M8 6v6",key:"18i7km"}],["path",{d:"M15 6v6",key:"1sg6z9"}],["path",{d:"M2 12h19.6",key:"de5uta"}],["path",{d:"M18 18h3s.5-1.7.8-2.8c.1-.4.2-.8.2-1.2 0-.4-.1-.8-.2-1.2l-1.4-5C20.1 6.8 19.1 6 18 6H4a2 2 0 0 0-2 2v10h3",key:"1wwztk"}],["circle",{cx:"7",cy:"18",r:"2",key:"19iecd"}],["path",{d:"M9 18h5",key:"lrx6i"}],["circle",{cx:"16",cy:"18",r:"2",key:"1v4tcr"}]]);/**
 * @license lucide-react v0.469.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const me=ce("TramFront",[["rect",{width:"16",height:"16",x:"4",y:"3",rx:"2",key:"1wxw4b"}],["path",{d:"M4 11h16",key:"mpoxn0"}],["path",{d:"M12 3v8",key:"1h2ygw"}],["path",{d:"m8 19-2 3",key:"13i0xs"}],["path",{d:"m18 22-2-3",key:"1p0ohu"}],["path",{d:"M8 15h.01",key:"a7atzg"}],["path",{d:"M16 15h.01",key:"rnfrdf"}]]);function G(){return G=Object.assign?Object.assign.bind():function(a){for(var r=1;r<arguments.length;r++){var n=arguments[r];for(var i in n)({}).hasOwnProperty.call(n,i)&&(a[i]=n[i])}return a},G.apply(null,arguments)}function te(a){if(a===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return a}function Y(a,r){return Y=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(n,i){return n.__proto__=i,n},Y(a,r)}function fe(a,r){a.prototype=Object.create(r.prototype),a.prototype.constructor=a,Y(a,r)}var re=Number.isNaN||function(r){return typeof r=="number"&&r!==r};function pe(a,r){return!!(a===r||re(a)&&re(r))}function ge(a,r){if(a.length!==r.length)return!1;for(var n=0;n<a.length;n++)if(!pe(a[n],r[n]))return!1;return!0}function K(a,r){r===void 0&&(r=ge);var n,i=[],o,v=!1;function u(){for(var I=[],x=0;x<arguments.length;x++)I[x]=arguments[x];return v&&n===this&&r(I,i)||(o=a.apply(this,I),v=!0,n=this,i=I),o}return u}var ve=typeof performance=="object"&&typeof performance.now=="function",ne=ve?function(){return performance.now()}:function(){return Date.now()};function ae(a){cancelAnimationFrame(a.id)}function Se(a,r){var n=ne();function i(){ne()-n>=r?a.call(null):o.id=requestAnimationFrame(i)}var o={id:requestAnimationFrame(i)};return o}var V=-1;function ie(a){if(a===void 0&&(a=!1),V===-1||a){var r=document.createElement("div"),n=r.style;n.width="50px",n.height="50px",n.overflow="scroll",document.body.appendChild(r),V=r.offsetWidth-r.clientWidth,document.body.removeChild(r)}return V}var $=null;function se(a){if(a===void 0&&(a=!1),$===null||a){var r=document.createElement("div"),n=r.style;n.width="50px",n.height="50px",n.overflow="scroll",n.direction="rtl";var i=document.createElement("div"),o=i.style;return o.width="100px",o.height="100px",r.appendChild(i),document.body.appendChild(r),r.scrollLeft>0?$="positive-descending":(r.scrollLeft=1,r.scrollLeft===0?$="negative":$="positive-ascending"),document.body.removeChild(r),$}return $}var Ie=150,ye=function(r,n){return r};function xe(a){var r,n=a.getItemOffset,i=a.getEstimatedTotalSize,o=a.getItemSize,v=a.getOffsetForIndexAndAlignment,u=a.getStartIndexForOffset,I=a.getStopIndexForStartIndex,x=a.initInstanceProps,j=a.shouldResetStyleCacheOnItemSizeChange,b=a.validateProps;return r=function(N){fe(z,N);function z(C){var t;return t=N.call(this,C)||this,t._instanceProps=x(t.props,te(t)),t._outerRef=void 0,t._resetIsScrollingTimeoutId=null,t.state={instance:te(t),isScrolling:!1,scrollDirection:"forward",scrollOffset:typeof t.props.initialScrollOffset=="number"?t.props.initialScrollOffset:0,scrollUpdateWasRequested:!1},t._callOnItemsRendered=void 0,t._callOnItemsRendered=K(function(s,l,d,h){return t.props.onItemsRendered({overscanStartIndex:s,overscanStopIndex:l,visibleStartIndex:d,visibleStopIndex:h})}),t._callOnScroll=void 0,t._callOnScroll=K(function(s,l,d){return t.props.onScroll({scrollDirection:s,scrollOffset:l,scrollUpdateWasRequested:d})}),t._getItemStyle=void 0,t._getItemStyle=function(s){var l=t.props,d=l.direction,h=l.itemSize,M=l.layout,m=t._getItemStyleCache(j&&h,j&&M,j&&d),y;if(m.hasOwnProperty(s))y=m[s];else{var k=n(t.props,s,t._instanceProps),T=o(t.props,s,t._instanceProps),O=d==="horizontal"||M==="horizontal",A=d==="rtl",R=O?k:0;m[s]=y={position:"absolute",left:A?void 0:R,right:A?R:void 0,top:O?0:k,height:O?"100%":T,width:O?T:"100%"}}return y},t._getItemStyleCache=void 0,t._getItemStyleCache=K(function(s,l,d){return{}}),t._onScrollHorizontal=function(s){var l=s.currentTarget,d=l.clientWidth,h=l.scrollLeft,M=l.scrollWidth;t.setState(function(m){if(m.scrollOffset===h)return null;var y=t.props.direction,k=h;if(y==="rtl")switch(se()){case"negative":k=-h;break;case"positive-descending":k=M-d-h;break}return k=Math.max(0,Math.min(k,M-d)),{isScrolling:!0,scrollDirection:m.scrollOffset<k?"forward":"backward",scrollOffset:k,scrollUpdateWasRequested:!1}},t._resetIsScrollingDebounced)},t._onScrollVertical=function(s){var l=s.currentTarget,d=l.clientHeight,h=l.scrollHeight,M=l.scrollTop;t.setState(function(m){if(m.scrollOffset===M)return null;var y=Math.max(0,Math.min(M,h-d));return{isScrolling:!0,scrollDirection:m.scrollOffset<y?"forward":"backward",scrollOffset:y,scrollUpdateWasRequested:!1}},t._resetIsScrollingDebounced)},t._outerRefSetter=function(s){var l=t.props.outerRef;t._outerRef=s,typeof l=="function"?l(s):l!=null&&typeof l=="object"&&l.hasOwnProperty("current")&&(l.current=s)},t._resetIsScrollingDebounced=function(){t._resetIsScrollingTimeoutId!==null&&ae(t._resetIsScrollingTimeoutId),t._resetIsScrollingTimeoutId=Se(t._resetIsScrolling,Ie)},t._resetIsScrolling=function(){t._resetIsScrollingTimeoutId=null,t.setState({isScrolling:!1},function(){t._getItemStyleCache(-1,null)})},t}z.getDerivedStateFromProps=function(t,s){return Me(t,s),b(t),null};var _=z.prototype;return _.scrollTo=function(t){t=Math.max(0,t),this.setState(function(s){return s.scrollOffset===t?null:{scrollDirection:s.scrollOffset<t?"forward":"backward",scrollOffset:t,scrollUpdateWasRequested:!0}},this._resetIsScrollingDebounced)},_.scrollToItem=function(t,s){s===void 0&&(s="auto");var l=this.props,d=l.itemCount,h=l.layout,M=this.state.scrollOffset;t=Math.max(0,Math.min(t,d-1));var m=0;if(this._outerRef){var y=this._outerRef;h==="vertical"?m=y.scrollWidth>y.clientWidth?ie():0:m=y.scrollHeight>y.clientHeight?ie():0}this.scrollTo(v(this.props,t,s,M,this._instanceProps,m))},_.componentDidMount=function(){var t=this.props,s=t.direction,l=t.initialScrollOffset,d=t.layout;if(typeof l=="number"&&this._outerRef!=null){var h=this._outerRef;s==="horizontal"||d==="horizontal"?h.scrollLeft=l:h.scrollTop=l}this._callPropsCallbacks()},_.componentDidUpdate=function(){var t=this.props,s=t.direction,l=t.layout,d=this.state,h=d.scrollOffset,M=d.scrollUpdateWasRequested;if(M&&this._outerRef!=null){var m=this._outerRef;if(s==="horizontal"||l==="horizontal")if(s==="rtl")switch(se()){case"negative":m.scrollLeft=-h;break;case"positive-ascending":m.scrollLeft=h;break;default:var y=m.clientWidth,k=m.scrollWidth;m.scrollLeft=k-y-h;break}else m.scrollLeft=h;else m.scrollTop=h}this._callPropsCallbacks()},_.componentWillUnmount=function(){this._resetIsScrollingTimeoutId!==null&&ae(this._resetIsScrollingTimeoutId)},_.render=function(){var t=this.props,s=t.children,l=t.className,d=t.direction,h=t.height,M=t.innerRef,m=t.innerElementType,y=t.innerTagName,k=t.itemCount,T=t.itemData,O=t.itemKey,A=O===void 0?ye:O,R=t.layout,D=t.outerElementType,U=t.outerTagName,q=t.style,B=t.useIsScrolling,H=t.width,e=this.state.isScrolling,p=d==="horizontal"||R==="horizontal",g=p?this._onScrollHorizontal:this._onScrollVertical,S=this._getRangeToRender(),L=S[0],E=S[1],w=[];if(k>0)for(var P=L;P<=E;P++)w.push(f.createElement(s,{data:T,key:A(P,T),index:P,isScrolling:B?e:void 0,style:this._getItemStyle(P)}));var F=i(this.props,this._instanceProps);return f.createElement(D||U||"div",{className:l,onScroll:g,ref:this._outerRefSetter,style:G({position:"relative",height:h,width:H,overflow:"auto",WebkitOverflowScrolling:"touch",willChange:"transform",direction:d},q)},f.createElement(m||y||"div",{children:w,ref:M,style:{height:p?"100%":F,pointerEvents:e?"none":void 0,width:p?F:"100%"}}))},_._callPropsCallbacks=function(){if(typeof this.props.onItemsRendered=="function"){var t=this.props.itemCount;if(t>0){var s=this._getRangeToRender(),l=s[0],d=s[1],h=s[2],M=s[3];this._callOnItemsRendered(l,d,h,M)}}if(typeof this.props.onScroll=="function"){var m=this.state,y=m.scrollDirection,k=m.scrollOffset,T=m.scrollUpdateWasRequested;this._callOnScroll(y,k,T)}},_._getRangeToRender=function(){var t=this.props,s=t.itemCount,l=t.overscanCount,d=this.state,h=d.isScrolling,M=d.scrollDirection,m=d.scrollOffset;if(s===0)return[0,0,0,0];var y=u(this.props,m,this._instanceProps),k=I(this.props,y,m,this._instanceProps),T=!h||M==="backward"?Math.max(1,l):1,O=!h||M==="forward"?Math.max(1,l):1;return[Math.max(0,y-T),Math.max(0,Math.min(s-1,k+O)),y,k]},z}(f.PureComponent),r.defaultProps={direction:"ltr",itemData:void 0,layout:"vertical",overscanCount:2,useIsScrolling:!1},r}var Me=function(r,n){r.children,r.direction,r.height,r.layout,r.innerTagName,r.outerTagName,r.width,n.instance},ze=50,W=function(r,n,i){var o=r,v=o.itemSize,u=i.itemMetadataMap,I=i.lastMeasuredIndex;if(n>I){var x=0;if(I>=0){var j=u[I];x=j.offset+j.size}for(var b=I+1;b<=n;b++){var N=v(b);u[b]={offset:x,size:N},x+=N}i.lastMeasuredIndex=n}return u[n]},Ce=function(r,n,i){var o=n.itemMetadataMap,v=n.lastMeasuredIndex,u=v>0?o[v].offset:0;return u>=i?ue(r,n,v,0,i):ke(r,n,Math.max(0,v),i)},ue=function(r,n,i,o,v){for(;o<=i;){var u=o+Math.floor((i-o)/2),I=W(r,u,n).offset;if(I===v)return u;I<v?o=u+1:I>v&&(i=u-1)}return o>0?o-1:0},ke=function(r,n,i,o){for(var v=r.itemCount,u=1;i<v&&W(r,i,n).offset<o;)i+=u,u*=2;return ue(r,n,Math.min(i,v-1),Math.floor(i/2),o)},le=function(r,n){var i=r.itemCount,o=n.itemMetadataMap,v=n.estimatedItemSize,u=n.lastMeasuredIndex,I=0;if(u>=i&&(u=i-1),u>=0){var x=o[u];I=x.offset+x.size}var j=i-u-1,b=j*v;return I+b},J=xe({getItemOffset:function(r,n,i){return W(r,n,i).offset},getItemSize:function(r,n,i){return i.itemMetadataMap[n].size},getEstimatedTotalSize:le,getOffsetForIndexAndAlignment:function(r,n,i,o,v,u){var I=r.direction,x=r.height,j=r.layout,b=r.width,N=I==="horizontal"||j==="horizontal",z=N?b:x,_=W(r,n,v),C=le(r,v),t=Math.max(0,Math.min(C-z,_.offset)),s=Math.max(0,_.offset-z+_.size+u);switch(i==="smart"&&(o>=s-z&&o<=t+z?i="auto":i="center"),i){case"start":return t;case"end":return s;case"center":return Math.round(s+(t-s)/2);case"auto":default:return o>=s&&o<=t?o:o<s?s:t}},getStartIndexForOffset:function(r,n,i){return Ce(r,i,n)},getStopIndexForStartIndex:function(r,n,i,o){for(var v=r.direction,u=r.height,I=r.itemCount,x=r.layout,j=r.width,b=v==="horizontal"||x==="horizontal",N=b?j:u,z=W(r,n,o),_=i+N,C=z.offset+z.size,t=n;t<I-1&&C<_;)t++,C+=W(r,t,o).size;return t},initInstanceProps:function(r,n){var i=r,o=i.estimatedItemSize,v={itemMetadataMap:{},estimatedItemSize:o||ze,lastMeasuredIndex:-1};return n.resetAfterIndex=function(u,I){I===void 0&&(I=!0),v.lastMeasuredIndex=Math.min(v.lastMeasuredIndex,u-1),n._getItemStyleCache(-1),I&&n.forceUpdate()},v},shouldResetStyleCacheOnItemSizeChange:!1,validateProps:function(r){r.itemSize}});const oe="likedStations",_e=a=>{try{const r=localStorage.getItem(a);return r?JSON.parse(r):[]}catch{return[]}},be=(a,r)=>{try{localStorage.setItem(a,JSON.stringify(r))}catch{}},Oe=({userLocation:a,setActiveStation:r,busStops:n,szStops:i})=>{const[o,v]=f.useState(""),[u,I]=f.useState(""),[x,j]=f.useState("nearMe"),[b,N]=f.useState(()=>_e(oe)),[z]=f.useState(()=>{const e=localStorage.getItem("stationRadius");return e?JSON.parse(e):{busRadius:5,szRadius:20}});f.useEffect(()=>{const e=setTimeout(()=>{I(o)},300);return()=>clearTimeout(e)},[o]);const _=f.useMemo(()=>{const e=S=>S*(Math.PI/180),g=S=>{var X,ee;const L=a[0],E=a[1],w=((X=S.gpsLocation)==null?void 0:X[0])??S.lat,P=((ee=S.gpsLocation)==null?void 0:ee[1])??S.lon,F=e(w-L),Z=e(P-E),Q=Math.sin(F/2)*Math.sin(F/2)+Math.cos(e(L))*Math.cos(e(w))*Math.sin(Z/2)*Math.sin(Z/2);return 6371*(2*Math.atan2(Math.sqrt(Q),Math.sqrt(1-Q)))};return[...n.map(S=>({...S,type:"bus",distance:g(S)})),...i.map(S=>({...S,type:"sz",distance:g(S)}))]},[n,i,a]),C=f.useCallback(e=>(e==null?void 0:e.ref_id)||(e==null?void 0:e.id)||(e==null?void 0:e.name),[]),t=f.useCallback(e=>{const p=C(e);return b.some(g=>g.id===p)},[b,C]),s=f.useCallback((e,p)=>{p==null||p.stopPropagation();const g=C(e);N(S=>{const E=S.some(w=>w.id===g)?S.filter(w=>w.id!==g):[...S,{id:g,name:e.name,data:e}];return be(oe,E),E})},[C]),l=f.useMemo(()=>_.filter(e=>{const p=e.type==="bus"?z==null?void 0:z.busRadius:z==null?void 0:z.szRadius;return e.distance<=p&&e.distance>0}).filter(e=>e.name.toLowerCase().includes(u.toLowerCase())).sort((e,p)=>e.distance-p.distance),[_,u,z]),d=f.useMemo(()=>u.length<3?[]:_.filter(e=>e.name.toLowerCase().includes(u.toLowerCase())).sort((e,p)=>e.name.localeCompare(p.name)),[_,u]),h=f.useMemo(()=>b.filter(e=>e.name.toLowerCase().includes(u.toLowerCase())),[b,u]),M=f.useCallback(e=>{r(e),window.location.hash="/lines",localStorage.setItem("activeStation",JSON.stringify(e))},[r]),m=f.useRef(null),[y,k]=f.useState(400),T=f.useRef(null),O=f.useRef(null),A=f.useRef(null),R=f.useRef({});f.useEffect(()=>{const e=()=>{if(m.current){const p=m.current.getBoundingClientRect(),g=window.innerHeight-p.top-80;k(Math.max(200,g))}};return e(),window.addEventListener("resize",e),()=>window.removeEventListener("resize",e)},[]),f.useEffect(()=>{var e;R.current={},(e=T.current)==null||e.resetAfterIndex(0)},[l]),f.useEffect(()=>{var e;R.current={},(e=O.current)==null||e.resetAfterIndex(0)},[d]),f.useEffect(()=>{var e;R.current={},(e=A.current)==null||e.resetAfterIndex(0)},[h]);const D=f.useCallback((e,p,g)=>{var w;const S=`${p}-${g}`;if(R.current[S])return R.current[S];let L=52;return(((w=e==null?void 0:e.routes_on_stop)==null?void 0:w.length)||0)>0&&(L+=26),R.current[S]=L,L},[]),U=f.useCallback(e=>D(l[e],"nearMe",e),[l,D]),q=f.useCallback(e=>D(d[e],"all",e),[d,D]),B=f.useCallback(e=>{const p=h[e];return D(p==null?void 0:p.data,"liked",e)},[h,D]),H=f.memo(({station:e,onSelect:p,isLiked:g,onToggleLike:S,showDistance:L})=>{var E,w;return c.jsxs("div",{className:"station-item-search",onClick:p,children:[c.jsxs("div",{className:"station-content",children:[c.jsxs("div",{className:"name",children:[(e==null?void 0:e.type)==="sz"?c.jsx(me,{size:24}):c.jsx(he,{size:24}),c.jsx("h3",{children:e==null?void 0:e.name}),(e==null?void 0:e.vCenter)!==null&&(e==null?void 0:e.type)!=="sz"&&c.jsx("span",{style:{fontSize:"11px",backgroundColor:(e==null?void 0:e.vCenter)===!0?"darkgreen":"#BA8E23",color:"var(--text-color)",padding:"2px 6px",borderRadius:"4px",height:"fit-content",marginTop:"auto",marginBottom:"auto",textWrap:"nowrap"},children:(e==null?void 0:e.vCenter)===!0?"V center":"Iz centra"})]}),c.jsxs("ul",{className:"station-info",children:[(E=e==null?void 0:e.routes_on_stop)==null?void 0:E.slice(0,6).map((P,F)=>c.jsx("li",{children:c.jsx("p",{children:P})},F)),((w=e==null?void 0:e.routes_on_stop)==null?void 0:w.length)>6&&c.jsx("li",{children:c.jsxs("p",{children:["+ ",e.routes_on_stop.length-6]})})]})]}),L&&(e==null?void 0:e.distance)&&c.jsxs("span",{className:"distance",children:[e.distance.toFixed(1)," km"]}),c.jsx("button",{className:`like-btn ${g?"liked":""}`,onClick:S,"aria-label":g?"Odstrani iz priljubljenih":"Dodaj med priljubljene",children:c.jsx(de,{size:20,fill:g?"currentColor":"none"})})]})});return c.jsxs("div",{className:"insideDiv",children:[c.jsx("h2",{children:"Postaje"}),c.jsx("input",{type:"text",placeholder:x==="all"?"Vnesite vsaj 3 znake...":"Išči postaje...",className:"search-input",value:o,onChange:e=>v(e.target.value)}),c.jsxs("div",{className:"top-nav",children:[c.jsx("button",{className:x==="nearMe"?"active":"",onClick:()=>j("nearMe"),children:"V bližini"}),c.jsx("button",{className:x==="all"?"active":"",onClick:()=>j("all"),children:"Vse"}),c.jsx("button",{className:x==="liked"?"active":"",onClick:()=>j("liked"),children:"Priljubljene"})]}),c.jsxs("div",{className:"results station-list",ref:m,children:[x==="nearMe"&&c.jsxs(c.Fragment,{children:[l.length===0&&c.jsx("p",{className:"empty-message",children:"Ni postaj v bližini."}),l.length>0&&c.jsx(J,{ref:T,height:y,itemCount:l.length,itemSize:U,estimatedItemSize:50,width:"100%",overscanCount:5,children:({index:e,style:p})=>{const g=l[e];return c.jsx("div",{style:p,children:c.jsx(H,{station:g,isLiked:t(g),onToggleLike:S=>s(g,S),onSelect:()=>M(g),showDistance:!0},`near-${e}`)})}})]}),x==="all"&&c.jsxs(c.Fragment,{children:[o.length<3&&c.jsx("p",{className:"empty-message",children:"Vnesite vsaj 3 znake za iskanje."}),o.length>=3&&d.length===0&&c.jsx("p",{className:"empty-message",children:"Ni rezultatov."}),d.length>0&&c.jsx(J,{ref:O,height:y,itemCount:d.length,itemSize:q,estimatedItemSize:50,width:"100%",overscanCount:5,children:({index:e,style:p})=>{const g=d[e];return c.jsx("div",{style:p,children:c.jsx(H,{station:g,isLiked:t(g),onToggleLike:S=>s(g,S),onSelect:()=>M(g),showDistance:!1},`all-${e}`)})}})]}),x==="liked"&&c.jsxs(c.Fragment,{children:[h.length===0&&c.jsx("p",{className:"empty-message",children:"Ni priljubljenih postaj. Kliknite na ❤️ za dodajanje."}),h.length>0&&c.jsx(J,{ref:A,height:y,itemCount:h.length,itemSize:B,estimatedItemSize:50,width:"100%",overscanCount:5,children:({index:e,style:p})=>{const g=h[e];return c.jsx("div",{style:p,children:c.jsx(H,{station:g.data,isLiked:!0,onToggleLike:S=>s(g.data,S),onSelect:()=>M(g.data),showDistance:!1},`liked-${e}`)})}})]})]})]})};export{Oe as default};
